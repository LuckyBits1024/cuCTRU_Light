#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <time.h>
#include "ntt.h"
#include "params.h"

int main(){
    // 初始化随机数生成器的种子
    srand(time(NULL));

    // 指定范围
    int min = 0;
    int max = CTRU_Q;

    int16_t toNttArrays[CTRU_N] = {
        494, 675, 181, 490, 588, 147, 140, 252, 481, 713, 318, 146, 579, 731, 287, 481, 
        635, 155, 93, 611, 587, 343, 570, 676, 765, 202, 264, 28, 727, 680, 468, 451, 
        585, 649, 323, 555, 179, 464, 37, 42, 559, 355, 188, 520, 316, 476, 231, 181, 
        13, 476, 174, 752, 49, 127, 658, 44, 329, 152, 72, 286, 214, 692, 119, 181, 
        572, 443, 736, 133, 289, 3, 175, 78, 511, 363, 750, 209, 221, 212, 543, 386, 
        688, 99, 369, 738, 226, 409, 164, 555, 714, 237, 223, 310, 311, 343, 492, 113, 
        168, 610, 246, 457, 766, 421, 687, 507, 167, 667, 98, 540, 109, 641, 157, 180, 
        741, 678, 148, 197, 317, 312, 135, 413, 701, 510, 724, 243, 235, 598, 508, 403, 
        438, 137, 242, 586, 558, 159, 475, 107, 209, 574, 648, 470, 445, 35, 650, 568, 
        713, 180, 148, 412, 493, 283, 208, 576, 175, 314, 201, 411, 142, 710, 196, 732, 
        77, 439, 549, 17, 598, 254, 277, 37, 210, 155, 660, 656, 342, 540, 606, 437, 
        721, 754, 231, 596, 419, 439, 402, 595, 753, 756, 236, 277, 696, 432, 240, 155, 
        253, 171, 324, 82, 425, 753, 271, 18, 138, 161, 674, 632, 84, 662, 299, 35, 
        647, 683, 631, 296, 504, 415, 121, 640, 401, 509, 147, 479, 324, 539, 16, 577, 
        710, 493, 41, 518, 476, 465, 536, 767, 626, 592, 11, 92, 484, 463, 127, 361, 
        376, 140, 40, 110, 708, 161, 750, 491, 53, 280, 353, 529, 49, 369, 488, 760, 
        244, 530, 508, 103, 225, 426, 100, 233, 248, 111, 326, 732, 574, 605, 476, 332, 
        128, 516, 595, 218, 59, 575, 709, 264, 85, 292, 23, 287, 44, 512, 277, 440, 
        424, 167, 543, 649, 745, 25, 264, 223, 289, 742, 337, 245, 578, 195, 578, 88, 
        711, 403, 306, 153, 360, 245, 417, 598, 690, 593, 115, 116, 487, 544, 556, 141, 
        93, 482, 20, 68, 507, 436, 443, 26, 409, 162, 424, 217, 358, 384, 457, 451, 
        17, 763, 604, 529, 390, 404, 509, 310, 227, 624, 578, 96, 550, 365, 237, 25, 
        77, 257, 245, 736, 75, 688, 145, 484, 233, 569, 701, 591, 183, 388, 424, 352, 
        533, 411, 263, 154, 197, 3, 616, 576, 9, 425, 672, 560, 172, 139, 585, 401, 
        548, 61, 519, 623, 131, 664, 338, 364, 615, 421, 337, 180, 192, 144, 532, 725, 
        555, 26, 109, 752, 181, 108, 558, 190, 533, 460, 750, 87, 599, 718, 488, 377, 
        161, 237, 382, 292, 284, 720, 39, 129, 372, 528, 310, 564, 672, 224, 671, 457, 
        402, 11, 591, 583, 271, 379, 4, 186, 221, 136, 273, 202, 236, 143, 731, 397, 
        532, 344, 72, 46, 294, 263, 328, 48, 21, 20, 764, 694, 396, 666, 533, 29, 
        59, 507, 764, 330, 116, 150, 516, 490, 287, 171, 692, 523, 466, 654, 303, 228, 
        228, 375, 427, 674, 638, 137, 723, 41, 157, 717, 117, 553, 613, 651, 734, 54, 
        540, 729, 384, 38, 109, 282, 528, 548, 453, 451, 454, 149, 487, 757, 530, 97, 
    };

    /* for(int i = 0; i < CTRU_N; ++i){
        a[i] = min + rand() % (max - min + 1);
    }
    printf("生成的随机数组为\n");
    for(int i = 0; i < CTRU_N; ++i){
        printf("%d ", a[i]);
        if((i + 1) % 16 == 0) printf("\n");
    } */

    //测试数据 能直观看出来ntt的过程
    // int16_t a[CTRU_N] = {1};

    // 获取程序开始的时间
    clock_t startTime = clock();
    // for(int i = 0;i < 100000;i++){
    //     ntt(toNttArrays);
    // }
    ntt(toNttArrays);

    // 获取程序结束的时间
    clock_t endTime = clock();
    // 计算ntt函数的执行时间
    double nttTime = (double)(endTime - startTime) / CLOCKS_PER_SEC * 1000;
    printf("NTT函数执行时间为: %f 毫秒\n", nttTime);

    printf("NTT之后的数组为\n");
    for(int i = 0; i < CTRU_N; ++i){
        printf("%d ", toNttArrays[i]);
        if((i + 1) % 16 == 0) printf("\n");
    }

    int16_t fromNttArrays[CTRU_N];
    // 逐个元素复制数组内容
    for (int i = 0; i < CTRU_N; ++i) {
        fromNttArrays[i] = toNttArrays[i];
    }

    // 获取程序开始的时间
    startTime = clock();

    // for(int i = 0;i < 100000;i++){
    //     invntt(fromNttArrays);
    // }
    invntt(fromNttArrays);

    // 获取程序结束的时间
    endTime = clock();
    // 计算invntt函数的执行时间
    double invnttTime = (double)(endTime - startTime) / CLOCKS_PER_SEC * 1000;

    printf("逆NTT函数执行时间为: %f 毫秒\n", invnttTime);

    printf("逆NTT之后的数组为\n");
    for(int i = 0; i < CTRU_N; ++i){
        printf("%d ", fromNttArrays[i]);
        if((i + 1) % 16 == 0) printf("\n");
    }

    // 编译命令：gcc -o test_ntt test_ntt.c ntt.c reduce.c randombytes.c
    return 0;
}